<head>
<script type="module">
  import { Octokit, App } from "https://cdn.skypack.dev/octokit";

  const token = localStorage.getItem('TOKEN')
  const octokit = new Octokit({
    auth: token
  });

  let branches = [];

  function moveBranchToPR(branchName) {
    branches.forEach((branch) => {
      if (branch.name == branchName) {
        branch.location = 'PR'
      }
    })
  }

  async function getPullRequests() {
    const result = await octokit.request("GET /repos/{owner}/{repo}/pulls", {
      owner: "Shikaga",
      repo: "ABetterAgileBoard",
    });
    result.data.forEach((pr) => {
      debugger;
      moveBranchToPR(pr.head.ref)
    })
  }

  async function getBranches() {
    const result = await octokit.request("GET /repos/{owner}/{repo}/branches", {
      owner: "Shikaga",
      repo: "ABetterAgileBoard",
    });
    branches = result.data;
    branches.forEach((branch) => {
      branch.location = "DEV"
    })
  }

  function drawColumns() {
    branches.forEach((branch) => {
      if (branch.location == "DEV") {
        document.getElementById('in-dev').innerHTML += branch.name
      } else if (branch.location == "PR") {
        document.getElementById('review').innerHTML += branch.name
      }
    })

    
  }

  try {
    getBranches()
      .then(() => getPullRequests())
      .then(() => {drawColumns()})
    ;


  } catch (error) {
    console.log(`Error! Status: ${error.status}. Message: ${error.response.data.message}`)
  }

</script>
</head>
<body>
<div>Hello World!</div>
<div id='todo'>Todo</div>
<div id='in-dev'>In Dev | </div>
<div id='review'>Review | </div>
<div id='awaiting-merge'>Awaiting Merge</div>
<div id='done'>Done</div>
</body>
